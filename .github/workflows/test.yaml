on:
  # push:
  #   branches:
  #     - 'master'
  pull_request:
    branches:
      - 'main'

jobs:
  sync-chart:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get changed files
      id: changed-files
      uses: tj-actions/changed-files@v44

    - name: List all changed files
      env:
        ALL_CHANGED_FILES: ${{ steps.changed-files.outputs.all_changed_files }}
      run: |
        file_changed=${ALL_CHANGED_FILES}
        unique_charts=$(echo "$file_changed[@]" | sed 's/^"\|"$//g' | awk -F '/' '{print $1}' | uniq)

        echo $file_changed
        echo $unique_chart


    # - run: >
    #     https://github.com/CottonAcademy/Crazy-Kubernetes.git
    #     rm -rf Crazy-Kubernetes/test
    #     cp test Crazy-Kubernetes/
    #     cd Crazy-Kubernetes/
    #     git commit -t "update ks-core helm chart"
    #     gh pr create
    # - run: >
    #     git fetch origin ${{ github.base_ref }} --depth=1
    #     FILES=$(git diff --name-only origin/${{ github.base_ref }})
    #     echo "Modified files in this PR: $FILES"
    #     echo xxx
    #     file_changed=$(git diff --name-only HEAD~1)
    #     unique_charts=$(echo "$file_changed[@]" | sed 's/^"\|"$//g' | awk -F '/' '{print $1}' | uniq)
    #     echo $file_changed
    #     echo $unique_charts
