on:
  # push:
  #   branches:
  #     - 'master'
  pull_request:
    branches:
      - 'main'

jobs:
  sync-chart:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    # Way 1
    - uses: actions/checkout@v2
      with:
        ref: pull/${{ github.event.pull_request.number }}/head
        path: the_pr
     
    # Way 2
    - run: git fetch origin pull/$PR_NUM/head:THE_PR
      env:
        PR_NUM: ${{ github.event.pull_request.number }}

    - run: >
        BASE_SHA: ${{ github.event.pull_request.base.sha }}
 
        git --no-pager diff "$BASE_SHA..THE_PR" --name-only --output tmp/name-changed

        cat tmp/name-changed


    # - run: >
    #     https://github.com/CottonAcademy/Crazy-Kubernetes.git
    #     rm -rf Crazy-Kubernetes/test
    #     cp test Crazy-Kubernetes/
    #     cd Crazy-Kubernetes/
    #     git commit -t "update ks-core helm chart"
    #     gh pr create
    # - run: >
    #     git fetch origin ${{ github.base_ref }} --depth=1
    #     FILES=$(git diff --name-only origin/${{ github.base_ref }})
    #     echo "Modified files in this PR: $FILES"
    #     echo xxx
    #     file_changed=$(git diff --name-only HEAD~1)
    #     unique_charts=$(echo "$file_changed[@]" | sed 's/^"\|"$//g' | awk -F '/' '{print $1}' | uniq)
    #     echo $file_changed
    #     echo $unique_charts
