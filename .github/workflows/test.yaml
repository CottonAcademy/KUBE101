on:
  # push:
  #   branches:
  #     - 'master'
  pull_request:
    branches:
      - 'main'

jobs:
  sync-chart:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Get all test, doc and src files that have changed
      id: changed-files-yaml
      uses: tj-actions/changed-files@v44
      with:
        files_yaml: |
          extension:
            - '**/extension.yaml'
        # Optionally set `files_yaml_from_source_file` to read the YAML from a file. e.g `files_yaml_from_source_file: .github/changed-files.yml`
    - name: Run step if test file(s) change
      # NOTE: Ensure all outputs are prefixed by the same key used above e.g. `test_(...)` | `doc_(...)` | `src_(...)` when trying to access the `any_changed` output.
      if: steps.changed-files-yaml.outputs.test_any_changed == 'true'  
      env:
        TEST_ALL_CHANGED_FILES: ${{ steps.changed-files-yaml.outputs.test_all_changed_files }}
      run: |
        echo "One or more test file(s) has changed."
        echo "List all the files that have changed: $TEST_ALL_CHANGED_FILES"
        echo $TEST_ALL_CHANGED_FILES


    # - run: >
    #     https://github.com/CottonAcademy/Crazy-Kubernetes.git
    #     rm -rf Crazy-Kubernetes/test
    #     cp test Crazy-Kubernetes/
    #     cd Crazy-Kubernetes/
    #     git commit -t "update ks-core helm chart"
    #     gh pr create
    # - run: >
    #     git fetch origin ${{ github.base_ref }} --depth=1
    #     FILES=$(git diff --name-only origin/${{ github.base_ref }})
    #     echo "Modified files in this PR: $FILES"
    #     echo xxx
    #     file_changed=$(git diff --name-only HEAD~1)
    #     unique_charts=$(echo "$file_changed[@]" | sed 's/^"\|"$//g' | awk -F '/' '{print $1}' | uniq)
    #     echo $file_changed
    #     echo $unique_charts
